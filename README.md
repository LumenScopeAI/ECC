# ECC显存校验

## 多精度检查：
1、8bit
2、4bit

## 多错误状态检查
1、简单地按错误率翻转bit
2、按照GPU、DDR4的DRAM建模分析（包含1、更为严谨）

## 硬件建模

### GPU

- 单比特错误:影响单个DRAM比特位 (约68.5%)
- 多比特错误:影响多个DRAM比特位,包括: (约31.5%)
  - 字节对齐的多比特错误:影响一个字节内的多个比特 (占多比特错误的74.6%，约占总错误的23.5%)
  - 非字节对齐的多比特错误:可能影响多达64位数据 (占多比特错误的25.4%，约占总错误的8%)
- 行错误:影响DRAM的一整行或部分行
- 列错误:影响DRAM的一列或多列
- 单bank错误:影响DRAM的一个bank内的多行
- 多bank错误:影响DRAM的多个bank
- 全芯片错误:影响整个DRAM芯片
- 引脚错误:影响连接DRAM的单个引脚
- 通道错误:影响整个DRAM通道

1. 大小:
   - 论文中提到使用的是32GB HBM2内存。
   - HBM2每个堆叠通常有8个512MB的通道，总计4GB。

2. 行/列大小:
   - 一个行激活命令会带来2KB的数据到行缓冲区。
   - 每次读取访问32B (256位)。
   - 假设每个bank有16384行、128列，那么:
     - 一行 = 2KB = 16384位
     - 一列 = 32B = 256位

3. 常见大小:
   - HBM2常见容量有4GB、8GB、16GB、32GB等。

### DDR4内存

- 单比特错误:影响单个比特位 (约55.06%)
- 单字错误:影响单个DRAM字内的多个比特 (约0.325%)
- 单列错误:影响单列内的多行 (约3.85%)
- 双列错误:影响同一bank内两列 (约2.84%)
- 部分行错误:影响一行内2-128列 (约24.345%)
- 整行错误:影响一行内128-1024列 (约0.26%)
- 单行加单比特错误:影响一整行加同一bank内额外一个比特 (约0.975%)
- 双行错误:影响同一bank内两行 (约4.125%)
- 连续行错误:影响同一bank内连续的4或8行 (约0.555%)
- 行簇错误:影响同一bank内多个行簇 (约5.7%)
- 单bank错误:影响一个bank内超过1/4的行 (约0.065%)
- 1/4芯片错误:影响4个bank (约0.135%)
- 半芯片错误:影响5-8个bank (约0.09%)
- 全芯片错误:影响9-16个bank (约0.605%)
- 单引脚错误:影响单个数据引脚 (约0.67%)
- 单通道错误:影响单个通道 (约0.4%)

1. 大小:
   - 论文中使用的是32GB的RDIMM，每个DIMM由18个DDR4 DRAM设备组成。
   - 假设每个DRAM设备为16Gbit (2GB)。

2. 行/列大小:
   - DDR4通常每行8KB数据。
   - 假设每个bank有65536行、1024列，那么:
     - 一行 = 8KB = 65536位
     - 一列 = 128位 = 16字节

3. 常见大小:
   - DDR4 DRAM芯片常见容量有4Gbit、8Gbit、16Gbit等。
   - DDR4 DIMM常见容量有8GB、16GB、32GB、64GB等。



### 简单地按错误率翻转bit（无硬件建模）

#### ERR_TYPE 说明
- 0-7: 对应于8个比特位中的单个比特翻转
- 8: 所有位都可能翻转（随机多比特翻转）
- 9: ECC(64, 72) 编码后的错误注入
- 10-16: 部分比特保护（10保护1位，16保护7位）
- 17: 特殊编码 + ECC(64, 72) 汉明码 —— 参数+96偏移循环
- 18: 特殊编码 + 稀疏汉明码 —— 参数+96偏移循环保护前两位
- 19: 模拟ECC(64, 50)行为，但不进行实际编码解码（Value-aware Parity Insertion ECC for Fault-tolerant Deep Neural Network)

补充说明：

Value-aware Parity Insertion ECC for Fault-tolerant Deep Neural Network并不适用于LLM的参数分布，其大于阈值使用低位做校验位之后变0解码的操作会使得，此校验方法在高错误率时有优于ECC(64, 72)（9）和 参数+96偏移循环保护前两位（18）的表现，但是随着错误率降低，存在性能瓶颈，编解码操作带来的损失大于固有错误，且“稀疏矩阵”即额外存储空间开销极大，完全丧失优势。
